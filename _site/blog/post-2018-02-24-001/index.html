<!doctype html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="woody hellowoody woodyhello woody博客 woody个人主页 hellowoody github"><title>单页面网站禁用浏览器后退键</title><link rel="icon" href="../../favicon.ico"><link rel="stylesheet" type="text/css" href="../../assets/css/base.css"><link rel="stylesheet" type="text/css" href="../../assets/iconfont/iconfont.css"></head><body><div class="container"><div class="left-wrapper"><div class="left-wrapper-nav"><image class="portrait" src="../../assets/imgs/portrait.png" alt="blog portrait"><div class="introduction">"My name is woody,but i am coder not director."</div><div style="width: 100%;"><div class="introduction-table"><div class="iconfont icon-caidaniconwodehui"></div><div class="introduction-table-font">woody</div></div><div class="introduction-table"><div class="iconfont icon-weibiaoti102"></div><div class="introduction-table-font">Tianjin 天津</div></div><div class="introduction-table"><div class="iconfont icon-mail"></div><div class="introduction-table-font">woodyhello@gmail.com</div></div></div><div style="width:100%"><div style="margin-bottom:8px">发布工具</div><div class="tools"><div class="tools-button" onclick="window.open('https://woodyhello.com/html/compress_pic/main.html','_blank');">爱丫,图</div><div class="tools-button" onclick="window.open('https://hellowoody.github.io/searchBaiduMapCoordinate/','_blank');">坐标转换</div></div></div><div class="links"><div class="iconfont icon-github links-item" onclick="window.open('https://github.com/hellowoody','_blank');"></div><div class="iconfont icon-bilibili-fill links-item" onclick="window.open('https://space.bilibili.com/37370017','_blank');"></div><div class="iconfont icon-youtube-line links-item" onclick="window.open('https://www.youtube.com/channel/UCzqtMIUNXCJDhZHbIdcyAnw','_blank');"></div><div class="iconfont icon-zhihu-fill links-item" onclick="window.open('https://www.zhihu.com/people/hellowoody','_blank');"></div></div></image></div></div><div class="right-wrapper"><div style="width: 100%;display: flex;justify-content: flex-end;margin-bottom:12px;"><a class="btn-back" href="../../">回到首页</a></div><div><img style="width:100%;border-radius: 6px;" src="https://source.unsplash.com/random/900x300" alt="a good image"></div><h1>单页面网站禁用浏览器后退键</h1><p>该文章适用于angularjs创建的单页面应用SPA，如vuejs或react.js不在本文讨论范围内。</p><p>我用angularjs和sb-admin2实现了前端框架，在不考虑浏览器后退键的情况下，是用$state和$stateParams实现后退功能的，当然也可以自己创建全局单例或是localstroge、sessionstorge处理历史跳转数据。</p><p>项目上线后，客户反应当页面跳转到3级或4级页面，点击浏览器后退键时，页面返回上级页面后提示缺少参数，页面的数据也是空白的，为了解决这一问题，我的解决方案是禁用浏览器后退键，下面是解决方法：</p><p>在angular.module(&quot;appId&quot;).run()方法中，用$locationChangeStart监听url地址变化。代码如下：</p><pre><code>$rootScope.$on('$locationChangeStart',function(ev,to,from){
    if($rootScope.previousState &amp;&amp; $rootScope.nowState &amp;&amp; $rootScope.previousState == to)
    {
        console.log('not back');
        ev.preventDefault();
    }
    else{
        $rootScope.previousState = from;
        $rootScope.nowState = to;
    }
});
</code></pre><p>这样之前的问题就可以避免了，但是我也发现了一个小bug。虽然禁用了浏览器的后退键，用户点击业务页面上的返回按钮时，页面虽然成功返回到上一页面，但是浏览器地址栏的url没有变，当再次点击返回按钮时url又变回正常。</p><p>因为对功能没啥影响，就没有再深入了解该问题，如果有高人解决或是了解该问题，望请告知。</p><style>.utterances {
        max-width: unset;
    }</style><script src="https://utteranc.es/client.js" repo="hellowoody/blog-app" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></body></html>