<!doctype html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="woody hellowoody woodyhello woody博客 woody个人主页 hellowoody github"><title>debian下搭建邮件服务器</title><link rel="icon" href="../../favicon.ico"><link rel="stylesheet" type="text/css" href="../../assets/css/base.css"><link rel="stylesheet" type="text/css" href="../../assets/iconfont/iconfont.css"></head><body><div class="container"><div class="left-wrapper"><div class="left-wrapper-nav"><image class="portrait" src="../../assets/imgs/portrait.png" alt="blog portrait"><div class="introduction">"My name is woody,but i am coder not director."</div><div style="width: 100%;"><div class="introduction-table"><div class="iconfont icon-caidaniconwodehui"></div><div class="introduction-table-font">woody</div></div><div class="introduction-table"><div class="iconfont icon-weibiaoti102"></div><div class="introduction-table-font">Tianjin 天津</div></div><div class="introduction-table"><div class="iconfont icon-mail"></div><div class="introduction-table-font">woodyhello@gmail.com</div></div></div><div style="width:100%"><div style="margin-bottom:8px">发布工具</div><div class="tools"><div class="tools-button" onclick="window.open('https://woodyhello.com/html/compress_pic/main.html','_blank');">爱丫,图</div><div class="tools-button" onclick="window.open('https://hellowoody.github.io/searchBaiduMapCoordinate/','_blank');">坐标转换</div></div></div><div class="links"><div class="iconfont icon-github links-item" onclick="window.open('https://github.com/hellowoody','_blank');"></div><div class="iconfont icon-bilibili-fill links-item" onclick="window.open('https://space.bilibili.com/37370017','_blank');"></div><div class="iconfont icon-youtube-line links-item" onclick="window.open('https://www.youtube.com/channel/UCzqtMIUNXCJDhZHbIdcyAnw','_blank');"></div><div class="iconfont icon-zhihu-fill links-item" onclick="window.open('https://www.zhihu.com/people/hellowoody','_blank');"></div></div></image></div></div><div class="right-wrapper"><div style="width: 100%;display: flex;justify-content: flex-end;margin-bottom:12px;"><a class="btn-back" href="../../">回到首页</a></div><div><img style="width:100%;border-radius: 6px;" src="https://source.unsplash.com/random/900x300" alt="a good image"></div><h1>debian下搭建邮件服务器</h1><p>第一步</p><p>#apt-get update</p><p>#apt-get upgrade</p><p>#apt-get install postfix libsasl2-2 sasl2-bin libsasl2-modules dovecot-imapd dovecot-pop3d dovecot-common</p><p>第二步</p><p>#配置邮件服务器 首先，停掉这三项服务：</p><p>#postfix stop</p><p>#service dovecot stop</p><p></p><p>接下来，修改postfix的配置文件/etc/postfix/main.cf</p><p>由于采用了sasl做认证，同时用dovecot作为pop3、imap和smtp的服务，所以需要修改postfix的配置文件以适应需求。</p><p>在/etc/postfix/main.cf文件中增加以下信息以支持sasl认证和dovecot服务。</p><p>smtpd_sasl_type = dovecot</p><p>smtpd_sasl_path = private/auth</p><p>smtpd_sasl_auth_enable = yes</p><p>smtpd_sasl_local_domain = yourdomain.com</p><p>smtpd_recipient_restrictions = permit_mynetworks,permit_sasl_authenticated,reject_unauth_destination</p><p>smtpd_sasl_security_options = noanonymous</p><pre><code>  message_size_limit = 10240000
</code></pre><p>另外main.cf中的以下两个参数</p><p>myhostname = yourhostname</p><p>mydestination = yourdomain.com, localhost.localdomain, localhost</p><p>分别代表了你的服务器信息，myhostname是你当前主机名，mydestination其中的yourdomain.com则是邮件服务器名。</p><p>修改完毕后保存该文件。</p><p></p><p>接下来，修改/etc/dovecot/dovecot.conf文件</p><p>修改参数protocols为</p><p>protocols = pop3 imap</p><pre><code>  修改mail_location为

  mail_location = mbox:~/mail:INBOX=/var/mail/%u （这里需要注意dovecot设置的邮件类型为mbox，而postfix默认邮件格式也能是Maildir。如果这里设置的为mail_location=mail:~/Maildir，会出现收件箱里没有东西）
</code></pre><p>设置参数disable_plaintext_auth为</p><p>disable_plaintext_auth = no</p><p>找到auth default，将auth default改名为auth default2。</p><p>然后在这行前面增加如下信息</p><p>auth default {</p><p>mechanisms = plain login</p><p>passdb pam {</p><p>}</p><p>userdb passwd {</p><p>}</p><p>socket listen {</p><p>client {</p><p>path = /var/spool/postfix/private/auth</p><p>mode = 0660</p><p>user = postfix</p><p>group = postfix</p><p>}</p><p>}</p><p>}</p><p>注意：这里的每个‘{’前都有个空格。</p><p>然后保存该文件。</p><p>接下来，修改sasl配置文件。</p><p>debian默认的安装配置中sasl并不会自动启动，需要修改/etc/default/saslauthd文件。</p><p>将其中的START=no修改为START=yes。</p><p>修改</p><p>OPTIONS=&quot;-c -m /var/run/saslauthd&quot;</p><p>为</p><p>OPTIONS=&quot;-c -m /var/spool/postfix/var/run/saslauthd&quot;</p><p>然后保存该文件。</p><p>在启用sasl的情况下postfix运行需要sasldb2文件在postfix的chroot环境中。</p><p>同时为了保证saslauthd能和postfix通讯，需要作如下的修改。</p><p>删除位于/va/run目录下的saslauthd目录，然后创建一个指向/var/spool/postfix/var/run/saslauthd的符号连接。</p><p>sudo rm -r /var/run/saslauthd/</p><p>sudo mkdir -p /var/spool/postfix/var/run/saslauthd</p><p>sudo ln -s /var/spool/postfix/var/run/saslauthd /var/run</p><p>sudo chgrp sasl /var/spool/postfix/var/run/saslauthd</p><p>sudo adduser postfix sasl</p><p>另外postfix在运行的时候需要将/etc/sasldb2文件拷贝到chroot环境中。</p><p>修改/etc/init.d/postfix文件，修改其中的FILES变量，在其中增加etc/sasldb2</p><p>完成以上工作后启动三个服务。</p><p>#postfix start #service dovecot start</p><p>然后新增用户</p><p>adduser username</p><p>至此，邮件服务器的配置成功。</p><pre><code> 查询系统邮件日志文件：/var/log/mail.log
</code></pre><p>#启动Postfix 和 Dovecot</p><p>首先检查系统中是否安装了sendmail，一般情况都有sendmail，这里要先将sendmail服务关闭，或者是卸载sendmail</p><p>#service sendmail stop #关闭sendmail服务</p><p>#chkconfig sendmail off #关闭开机自动运行sendmail服务</p><p>#postfix start #打开postfix服务</p><p>#chkconfig postfix on #开机自动运行postfix服务（我设置后开机任旧不会自动运行postfix）</p><p>#service dovecot start #打开dovecot服务</p><p>#chkconfig dovecot on #开机自动运行dovecot服务</p><p>将postfix加入到root的组：</p><p>#usermod -G root postfix</p><p>检查服务是否开启，如果服务打开会显示如下结果</p><p>#nmap localhost</p><p>PORT STATE SERVICE</p><p>22/tcp open ssh</p><p>25/tcp open smtp</p><p>110/tcp open pop3</p><p>如果没有安装nmap命令，可以使用netstat命令</p><p>#netstat -nlt</p><p>添加邮件服务器用户并分配邮箱 首先添加邮件服务器用户</p><p>#adduser username //添加用户</p><p>#passwd username //设置密码</p><pre><code>由于前面设置mail_location=mbox:~/mail:INBOX=/var/mail/%u，所以，所创建的用户目录下有具有mail目录，如果不存在该目录，如下操作
</code></pre><p>#telnet ip地址 110</p><p>#user username</p><p>+OK</p><p>#pass password</p><p>+login</p><p>#chmod 700 /home/username/Maildir //很重要</p><style>.utterances {
                        max-width: unset;
                    }</style><script src="https://utteranc.es/client.js" repo="hellowoody/blog-app" issue-term="pathname" theme="github-light" crossorigin="anonymous" async></script></div></div></body></html>